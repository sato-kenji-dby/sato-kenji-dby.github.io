function E(t){return t!==null&&typeof t=="object"&&"name"in t&&typeof t.name=="string"}function S(t){return t!==null&&typeof t=="object"&&"step"in t&&typeof t.step=="number"&&"alt"in t&&typeof t.alt=="number"&&!isNaN(t.step)&&!isNaN(t.alt)}var P=[0,2,4,-1,1,3,5],j=P.map(t=>Math.floor(t*7/12));function $(t){const{step:n,alt:o,oct:e,dir:r=1}=t,a=P[n]+7*o;if(e===void 0)return[r*a];const c=e-j[n]-4*o;return[r*a,r*c]}var C=[3,0,4,1,5,2,6];function I(t){const[n,o,e]=t,r=C[x(n)],a=Math.floor((n+1)/7);if(o===void 0)return{step:r,alt:a,dir:e};const c=o+4*a+j[r];return{step:r,alt:a,oct:c,dir:e}}function x(t){const n=(t+1)%7;return n<0?7+n:n}var b=(t,n)=>Array(Math.abs(n)+1).join(t),O=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),M=new Map,G=t=>"CDEFGAB".charAt(t),F=t=>t<0?b("b",-t):b("#",t),k=t=>t[0]==="b"?-t.length:t.length;function u(t){const n=JSON.stringify(t),o=M.get(n);if(o)return o;const e=typeof t=="string"?X(t):S(t)?u(w(t)):E(t)?u(t.name):O;return M.set(n,e),e}var z=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function D(t){const n=z.exec(t);return n?[n[1].toUpperCase(),n[2].replace(/x/g,"##"),n[3],n[4]]:["","","",""]}function H(t){return u(I(t))}var L=(t,n)=>(t%n+n)%n,v=[0,2,4,5,7,9,11];function X(t){const n=D(t);if(n[0]===""||n[3]!=="")return O;const o=n[0],e=n[1],r=n[2],a=(o.charCodeAt(0)+3)%7,c=k(e),s=r.length?+r:void 0,i=$({step:a,alt:c,oct:s}),d=o+e+r,f=o+e,m=(v[a]+c+120)%12,l=s===void 0?L(v[a]+c,12)-12*99:v[a]+c+12*(s+1),N=l>=0&&l<=127?l:null,h=s===void 0?null:Math.pow(2,(l-69)/12)*440;return{empty:!1,acc:e,alt:c,chroma:m,coord:i,freq:h,height:l,letter:o,midi:N,name:d,oct:s,pc:f,step:a}}function w(t){const{step:n,alt:o,oct:e}=t,r=G(n);if(!r)return"";const a=r+F(o);return e||e===0?a+e:a}var A=(t,n)=>Array(Math.abs(n)+1).join(t),g=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),V="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",B="(AA|A|P|M|m|d|dd)([-+]?\\d+)",J=new RegExp("^"+V+"|"+B+"$");function Q(t){const n=J.exec(`${t}`);return n===null?["",""]:n[1]?[n[1],n[2]]:[n[4],n[3]]}var T={};function p(t){return typeof t=="string"?T[t]||(T[t]=U(t)):S(t)?p(K(t)):E(t)?p(t.name):g}var y=[0,2,4,5,7,9,11],R="PMMPPMM";function U(t){const n=Q(t);if(n[0]==="")return g;const o=+n[0],e=n[1],r=(Math.abs(o)-1)%7,a=R[r];if(a==="M"&&e==="P")return g;const c=a==="M"?"majorable":"perfectable",s=""+o+e,i=o<0?-1:1,d=o===8||o===-8?o:i*(r+1),f=Z(c,e),m=Math.floor((Math.abs(o)-1)/7),l=i*(y[r]+f+12*m),N=(i*(y[r]+f)%12+12)%12,h=$({step:r,alt:f,oct:m,dir:i});return{empty:!1,name:s,num:o,q:e,step:r,alt:f,dir:i,type:c,simple:d,semitones:l,chroma:N,coord:h,oct:m}}function Y(t,n){const[o,e=0]=t,r=o*7+e*12<0,a=n||r?[-o,-e,-1]:[o,e,1];return p(I(a))}function Z(t,n){return n==="M"&&t==="majorable"||n==="P"&&t==="perfectable"?0:n==="m"&&t==="majorable"?-1:/^A+$/.test(n)?n.length:/^d+$/.test(n)?-1*(t==="perfectable"?n.length:n.length+1):0}function K(t){const{step:n,alt:o,oct:e=0,dir:r}=t;if(!r)return"";const a=n+1+7*e,c=a===0?n+1:a,s=r<0?"-":"",i=R[n]==="M"?"majorable":"perfectable";return s+c+W(i,o)}function W(t,n){return n===0?t==="majorable"?"M":"P":n===-1&&t==="majorable"?"m":n>0?A("A",n):A("d",t==="perfectable"?n:n+1)}function q(t,n){const o=u(t),e=Array.isArray(n)?n:p(n).coord;if(o.empty||!e||e.length<2)return"";const r=o.coord,a=r.length===1?[r[0]+e[0]]:[r[0]+e[0],r[1]+e[1]];return H(a).name}function tt(t,n){const o=u(t),e=u(n);if(o.empty||e.empty)return"";const r=o.coord,a=e.coord,c=a[0]-r[0],s=r.length===2&&a.length===2?a[1]-r[1]:-Math.floor(c*7/12),i=e.height===o.height&&e.midi!==null&&o.oct===e.oct&&o.step>e.step;return Y([c,s],i).name}var _=u,nt=t=>_(t).pc,et=t=>_(t).midi,ot=q;export{ot as a,tt as d,_ as g,p as i,et as m,u as n,nt as p,q as t};
