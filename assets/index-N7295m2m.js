function S(t){return t!==null&&typeof t=="object"&&"name"in t&&typeof t.name=="string"}function C(t){return t!==null&&typeof t=="object"&&"step"in t&&typeof t.step=="number"&&"alt"in t&&typeof t.alt=="number"&&!isNaN(t.step)&&!isNaN(t.alt)}var P=[0,2,4,-1,1,3,5],j=P.map(t=>Math.floor(t*7/12));function $(t){const{step:n,alt:o,oct:e,dir:r=1}=t,c=P[n]+7*o;if(e===void 0)return[r*c];const a=e-j[n]-4*o;return[r*c,r*a]}var F=[3,0,4,1,5,2,6];function I(t){const[n,o,e]=t,r=F[R(n)],c=Math.floor((n+1)/7);if(o===void 0)return{step:r,alt:c,dir:e};const a=o+4*c+j[r];return{step:r,alt:c,oct:a,dir:e}}function R(t){const n=(t+1)%7;return n<0?7+n:n}var A=(t,n)=>Array(Math.abs(n)+1).join(t),O=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),M=new Map,D=t=>"CDEFGAB".charAt(t),_=t=>t<0?A("b",-t):A("#",t),x=t=>t[0]==="b"?-t.length:t.length;function l(t){const n=JSON.stringify(t),o=M.get(n);if(o)return o;const e=typeof t=="string"?B(t):C(t)?l(X(t)):S(t)?l(t.name):O;return M.set(n,e),e}var H=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function L(t){const n=H.exec(t);return n?[n[1].toUpperCase(),n[2].replace(/x/g,"##"),n[3],n[4]]:["","","",""]}function k(t){return l(I(t))}var z=(t,n)=>(t%n+n)%n,b=[0,2,4,5,7,9,11];function B(t){const n=L(t);if(n[0]===""||n[3]!=="")return O;const o=n[0],e=n[1],r=n[2],c=(o.charCodeAt(0)+3)%7,a=x(e),s=r.length?+r:void 0,i=$({step:c,alt:a,oct:s}),p=o+e+r,f=o+e,m=(b[c]+a+120)%12,u=s===void 0?z(b[c]+a,12)-12*99:b[c]+a+12*(s+1),N=u>=0&&u<=127?u:null,v=s===void 0?null:Math.pow(2,(u-69)/12)*440;return{empty:!1,acc:e,alt:a,chroma:m,coord:i,freq:v,height:u,letter:o,midi:N,name:p,oct:s,pc:f,step:c}}function X(t){const{step:n,alt:o,oct:e}=t,r=D(n);if(!r)return"";const c=r+_(o);return e||e===0?c+e:c}var w="C C# D D# E F F# G G# A A# B".split(" "),V="C Db D Eb E F Gb G Ab A Bb B".split(" ");function J(t,n={}){if(isNaN(t)||t===-1/0||t===1/0)return"";t=Math.round(t);const e=(n.sharps===!0?w:V)[t%12];if(n.pitchClass)return e;const r=Math.floor(t/12)-1;return e+r}var y=(t,n)=>Array(Math.abs(n)+1).join(t),g=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Q="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",U="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Y=new RegExp("^"+Q+"|"+U+"$");function Z(t){const n=Y.exec(`${t}`);return n===null?["",""]:n[1]?[n[1],n[2]]:[n[4],n[3]]}var T={};function d(t){return typeof t=="string"?T[t]||(T[t]=K(t)):C(t)?d(tt(t)):S(t)?d(t.name):g}var E=[0,2,4,5,7,9,11],G="PMMPPMM";function K(t){const n=Z(t);if(n[0]==="")return g;const o=+n[0],e=n[1],r=(Math.abs(o)-1)%7,c=G[r];if(c==="M"&&e==="P")return g;const a=c==="M"?"majorable":"perfectable",s=""+o+e,i=o<0?-1:1,p=o===8||o===-8?o:i*(r+1),f=q(a,e),m=Math.floor((Math.abs(o)-1)/7),u=i*(E[r]+f+12*m),N=(i*(E[r]+f)%12+12)%12,v=$({step:r,alt:f,oct:m,dir:i});return{empty:!1,name:s,num:o,q:e,step:r,alt:f,dir:i,type:a,simple:p,semitones:u,chroma:N,coord:v,oct:m}}function W(t,n){const[o,e=0]=t,r=o*7+e*12<0,c=n||r?[-o,-e,-1]:[o,e,1];return d(I(c))}function q(t,n){return n==="M"&&t==="majorable"||n==="P"&&t==="perfectable"?0:n==="m"&&t==="majorable"?-1:/^A+$/.test(n)?n.length:/^d+$/.test(n)?-1*(t==="perfectable"?n.length:n.length+1):0}function tt(t){const{step:n,alt:o,oct:e=0,dir:r}=t;if(!r)return"";const c=n+1+7*e,a=c===0?n+1:c,s=r<0?"-":"",i=G[n]==="M"?"majorable":"perfectable";return s+a+nt(i,o)}function nt(t,n){return n===0?t==="majorable"?"M":"P":n===-1&&t==="majorable"?"m":n>0?y("A",n):y("d",t==="perfectable"?n:n+1)}function et(t,n){const o=l(t),e=Array.isArray(n)?n:d(n).coord;if(o.empty||!e||e.length<2)return"";const r=o.coord,c=r.length===1?[r[0]+e[0]]:[r[0]+e[0],r[1]+e[1]];return k(c).name}function ot(t,n){const o=l(t),e=l(n);if(o.empty||e.empty)return"";const r=o.coord,c=e.coord,a=c[0]-r[0],s=r.length===2&&c.length===2?c[1]-r[1]:-Math.floor(a*7/12),i=e.height===o.height&&e.midi!==null&&o.oct===e.oct&&o.step>e.step;return W([a,s],i).name}var h=l,rt=t=>h(t).pc,ct=t=>h(t).midi,at=et;function st(t,n){const o=h(t);if(o.empty)return"";const e=h(n||J(o.midi||o.chroma,{sharps:o.alt<0,pitchClass:!0}));if(e.empty||e.chroma!==o.chroma)return"";if(o.oct===void 0)return e.pc;const r=o.chroma-o.alt,c=e.chroma-e.alt,a=r>11||c<0?-1:r<0||c>11?1:0,s=o.oct+a;return e.pc+s}export{at as a,C as b,S as c,ot as d,st as e,x as f,h as g,_ as h,d as i,ct as m,l as n,rt as p,et as t};
